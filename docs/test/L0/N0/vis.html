<!DOCTYPE html>
<html lang="en">
<head>
  <!-- -------------------------------------------------------
      1️⃣  Document metadata
       ------------------------------------------ -->
  <meta charset="UTF-8">
  <title>Circuit visualisations (lazy)</title>

  <!-- --------------------------------------------------------------
      2️⃣  Minimal styling – just enough to give each viz a place
       ---------------------------------------- -->
  <style>
    /* Every visualisation gets its own box.
       The height prevents the page from collapsing before the viz loads. */
    .circuit-viz {
      min-height: 300px;          /* reserve space while we fetch data   */
   margin: 2rem 0;             /* vertical breathing room       */
   border: 1px solid #ddd;     /* optional – makes the area obvious   */
      padding: 0.5rem;
    }
  </style>
</head>

<body>
<h1>Model: <b>allenai/OLMo-1B-hf</b></h1>
<h2>Layer: <b>0</b>. Neuron Index: <b>0</b></h2>
<table><tr>
<td><h4>gate+_in+</h4></td>
<td><h4>gate+_in-</h4></td>
<td><h4>gate-_in+</h4></td>
<td><h4>gate-_in-</h4></td>
</tr><tr>
<td>Frequency: <b>40.29%</b>.</td>
<td>Frequency: <b>0.10%</b>.</td>
<td>Frequency: <b>58.07%</b>.</td>
<td>Frequency: <b>1.55%</b>.</td>
</tr>
<tr>
<td>
            <b>hook_post</b>:<br>
            Max: <b>0.33</b>;<br>
            Min: <b>0.00</b>;<br>
            Avg: <b>0.06</b>.
            </td>
            
<td>
            <b>hook_post</b>:<br>
            Max: <b>0.00</b>;<br>
            Min: <b>-0.00</b>;<br>
            Avg: <b>-0.00</b>.
            </td>
            
<td>
            <b>hook_post</b>:<br>
            Max: <b>0.00</b>;<br>
            Min: <b>-0.26</b>;<br>
            Avg: <b>-0.06</b>.
            </td>
            
<td>
            <b>hook_post</b>:<br>
            Max: <b>0.12</b>;<br>
            Min: <b>0.00</b>;<br>
            Avg: <b>0.05</b>.
            </td>
            
</tr>
<tr>
<td>
            <b>hook_pre_linear</b>:<br>
            Max: <b>1.31</b>;<br>
            Min: <b>0.00</b>;<br>
            Avg: <b>0.56</b>.
            </td>
            
<td>
            <b>hook_pre_linear</b>:<br>
            Max: <b>0.00</b>;<br>
            Min: <b>-0.08</b>;<br>
            Avg: <b>-0.08</b>.
            </td>
            
<td>
            <b>hook_pre_linear</b>:<br>
            Max: <b>1.52</b>;<br>
            Min: <b>0.00</b>;<br>
            Avg: <b>0.62</b>.
            </td>
            
<td>
            <b>hook_pre_linear</b>:<br>
            Max: <b>0.00</b>;<br>
            Min: <b>-0.46</b>;<br>
            Avg: <b>-0.19</b>.
            </td>
            
</tr>
<tr>
<td>
            <b>hook_pre</b>:<br>
            Max: <b>0.68</b>;<br>
            Min: <b>0.00</b>;<br>
            Avg: <b>0.17</b>.
            </td>
            
<td>
            <b>hook_pre</b>:<br>
            Max: <b>0.11</b>;<br>
            Min: <b>0.00</b>;<br>
            Avg: <b>0.11</b>.
            </td>
            
<td>
            <b>hook_pre</b>:<br>
            Max: <b>0.00</b>;<br>
            Min: <b>-3.37</b>;<br>
            Avg: <b>-0.32</b>.
            </td>
            
<td>
            <b>hook_pre</b>:<br>
            Max: <b>0.00</b>;<br>
            Min: <b>-3.20</b>;<br>
            Avg: <b>-1.85</b>.
            </td>
            
</tr>
<tr>
<td>
            <b>swish</b>:<br>
            Max: <b>0.45</b>;<br>
            Min: <b>0.00</b>;<br>
            Avg: <b>0.10</b>.
            </td>
            
<td>
            <b>swish</b>:<br>
            Max: <b>0.06</b>;<br>
            Min: <b>0.00</b>;<br>
            Avg: <b>0.06</b>.
            </td>
            
<td>
            <b>swish</b>:<br>
            Max: <b>0.00</b>;<br>
            Min: <b>-0.28</b>;<br>
            Avg: <b>-0.10</b>.
            </td>
            
<td>
            <b>swish</b>:<br>
            Max: <b>0.00</b>;<br>
            Min: <b>-0.28</b>;<br>
            Avg: <b>-0.24</b>.
            </td>
            
</tr>
</table>
<h2>Prototypical activations for case gate+_in+</h2>
<h3>Extreme hook_post activations
<h4>Example 0</h4>
        <div class="circuit-viz" data-url=./gate+_in+_hook_post_example_0.json>
        </div>
<h4>Example 1</h4>
        <div class="circuit-viz" data-url=./gate+_in+_hook_post_example_1.json>
        </div>
<hr>
<h3>Extreme hook_pre_linear activations
<h4>Example 0</h4>
        <div class="circuit-viz" data-url=./gate+_in+_hook_pre_linear_example_0.json>
        </div>
<h4>Example 1</h4>
        <div class="circuit-viz" data-url=./gate+_in+_hook_pre_linear_example_1.json>
        </div>
<hr>
<h3>Extreme hook_pre activations
<h4>Example 0</h4>
        <div class="circuit-viz" data-url=./gate+_in+_hook_pre_example_0.json>
        </div>
<h4>Example 1</h4>
        <div class="circuit-viz" data-url=./gate+_in+_hook_pre_example_1.json>
        </div>
<hr>
<hr>
<hr>
<h2>Prototypical activations for case gate+_in-</h2>
<h3>Extreme hook_post activations
<h4>Example 0</h4>
        <div class="circuit-viz" data-url=./gate+_in-_hook_post_example_0.json>
        </div>
<hr>
<h3>Extreme hook_pre_linear activations
<h4>Example 0</h4>
        <div class="circuit-viz" data-url=./gate+_in-_hook_pre_linear_example_0.json>
        </div>
<hr>
<h3>Extreme hook_pre activations
<h4>Example 0</h4>
        <div class="circuit-viz" data-url=./gate+_in-_hook_pre_example_0.json>
        </div>
<hr>
<hr>
<hr>
<h2>Prototypical activations for case gate-_in+</h2>
<h3>Extreme hook_post activations
<h4>Example 0</h4>
        <div class="circuit-viz" data-url=./gate-_in+_hook_post_example_0.json>
        </div>
<h4>Example 1</h4>
        <div class="circuit-viz" data-url=./gate-_in+_hook_post_example_1.json>
        </div>
<hr>
<h3>Extreme hook_pre_linear activations
<h4>Example 0</h4>
        <div class="circuit-viz" data-url=./gate-_in+_hook_pre_linear_example_0.json>
        </div>
<h4>Example 1</h4>
        <div class="circuit-viz" data-url=./gate-_in+_hook_pre_linear_example_1.json>
        </div>
<hr>
<h3>Extreme hook_pre activations
<h4>Example 0</h4>
        <div class="circuit-viz" data-url=./gate-_in+_hook_pre_example_0.json>
        </div>
<h4>Example 1</h4>
        <div class="circuit-viz" data-url=./gate-_in+_hook_pre_example_1.json>
        </div>
<hr>
<h3>Extreme swish activations
<h4>Example 0</h4>
        <div class="circuit-viz" data-url=./gate-_in+_swish_example_0.json>
        </div>
<h4>Example 1</h4>
        <div class="circuit-viz" data-url=./gate-_in+_swish_example_1.json>
        </div>
<hr>
<hr>
<h2>Prototypical activations for case gate-_in-</h2>
<h3>Extreme hook_post activations
<h4>Example 0</h4>
        <div class="circuit-viz" data-url=./gate-_in-_hook_post_example_0.json>
        </div>
<h4>Example 1</h4>
        <div class="circuit-viz" data-url=./gate-_in-_hook_post_example_1.json>
        </div>
<hr>
<h3>Extreme hook_pre_linear activations
<h4>Example 0</h4>
        <div class="circuit-viz" data-url=./gate-_in-_hook_pre_linear_example_0.json>
        </div>
<h4>Example 1</h4>
        <div class="circuit-viz" data-url=./gate-_in-_hook_pre_linear_example_1.json>
        </div>
<hr>
<h3>Extreme hook_pre activations
<h4>Example 0</h4>
        <div class="circuit-viz" data-url=./gate-_in-_hook_pre_example_0.json>
        </div>
<h4>Example 1</h4>
        <div class="circuit-viz" data-url=./gate-_in-_hook_pre_example_1.json>
        </div>
<hr>
<h3>Extreme swish activations
<h4>Example 0</h4>
        <div class="circuit-viz" data-url=./gate-_in-_swish_example_0.json>
        </div>
<h4>Example 1</h4>
        <div class="circuit-viz" data-url=./gate-_in-_swish_example_1.json>
        </div>
<hr>
<hr><script type="module">
    /* ---------------------------------------
       4.1️⃣  Import the visualisation component **once**
       ------------------------------------------------------------- */
    import { render, ColoredTokensMulti } from
      "https://unpkg.com/circuitsvis@1.43.3/dist/cdn/esm.js";

    /* ---------------------------------------
       4.2️⃣  Helper: fetch the JSON and call the renderer
       ------------------------------------------------------------- */
    async function loadAndRender(containerEl) {
      // ① Grab the URL we stored in the data‑url attribute
      const url = containerEl.dataset.url;

      // ② Fetch the JSON file (browser does gzip/Brotli automatically)
      const response = await fetch(url);
      const payload = await response.json();   // → {tokens, values, labels}

      // ③ Give the container a stable id (required by circuitsvis)
      if (!containerEl.id) {
        containerEl.id = "viz-" + Math.random().toString(36).slice(2);
      }

      // ④ Finally draw the heat‑map onto a <canvas>
      //    CanvasTokensMulti is much faster than the default span‑based view.
      render(containerEl.id, ColoredTokensMulti, payload);
    }

    /* -----------------------------------------------------
      4.3️⃣  Lazy‑load with IntersectionObserver
       ---------------------------------------
       • The observer watches each .circuit‑viz element.
       • As soon as the element is within ~200 px of the viewport,
         we start loading its data and rendering it.
       • After we’ve started a viz we stop observing it (we only need it once).
       -------------------------------------------- */
    const observer = new IntersectionObserver(
      (entries) => {
        for (const entry of entries) {
          if (entry.isIntersecting) {               // element entered view?
            const el = entry.target;
            observer.unobserve(el);                 // stop watching this one
         loadAndRender(el);                   // kick off fetch + render
          }
        }
      },
      { rootMargin: "200px" }   // start loading a little *before* it appears
    );

    // ----------------------------------------
   // 4.4️⃣  Hook the observer up to every placeholder on the page
    // -----------------------------------------------------------
    document.querySelectorAll('.circuit-viz').forEach((el) => {
      observer.observe(el);
    });

  </script>
</body>
</html>